---
data: 2014-2-26
layout: post
thread: 1005
categories: iOS
tags: iOS
---
# iOS多线程编程  
## 同步方法
* __用户模式:__ (如原子操作(如利用单一全局变量)),不需要切换到内核态.  
* __内核模式:__ (可利用事件,信号量,互斥量)利用系统内核对象的但一性进行同步,使用时需要切换内核态与用户态.  

## 几个概念
* __线程同步:__ 指线程之间的一种制约关系,一个线程的执行依赖另一个线程的消息,当它没有得到另一个线程的消息时应等待,知道消息到达时,才唤醒.
* __线程异步:__ 指在一个进程中可共享的系统资源,在单个线程访问它时具有排它性,当有若干线程访问同一线程时,每次至多只有一个线程使用,其他要使用该资源的线程必须等待,直到占用资源的线程释放资源.(线程互斥可看作线程同步的特殊情况)  
* __信号量:__ 允许多个线程同时访问共享资源,但需要指定最大线程数量,没增加一条线程,可用资源引用计数要-1,只要可用资源引用计数>0,则可以发出信号量信号.

## 同步工具
* __原子操作:__ 原子操作是同步的一个简单形式,它处理简单的数据类型,优势是不妨碍惊蛰呢个的资源,对于简单操作,比如递增一个计数器,原子操作比锁更高的性能.
* __内存屏障:__ 是一个使用来确保内存操作按照正常的顺序工作的非阻塞工具.
* __Volatile变量:__ Volatile变量适用于独立变量的另一个内存限制类型.强制编译器每次使用变量的时候都从内存中加载.
* __锁:__ 最常用,可以用锁来保护临界区,临界区在同一个时间只能允许被一个线程访问.
* __条件:__ 条件是信号量的另外一种形式,它允许在条件为真的情况下,线程间互相发送信号.
* __selector方法:__ 允许你的 线程以异步的方式来传递消息,以确保它们在同一个线程上面执行是同步的。比如, 你可以通过执行 selector 消息来把一个从你分布计算的结果传递给你的应用的主线 程或其他目标线程。每个执行 selector 的请求都会被放入一个目标线程的 run loop 的队列里面,然后请求会按照它们到达的顺序被目标线程有序的处理。

## 线程成本
* 多线程会占用应用程序的内存使用和性能方面的资源,每个线程都需要分配一定的内核内存和应用程序内存空间的内存.
* 管理线程和协调其调度所需的核心数据结构存储在使用Wired Memory的内核中.
* 线程的堆栈空间和每个线程的数据都被存储在应用程序的内存中,所需成本较高,因为每次都需要和内核交互.
* 线程创建事件依赖于处理器的负载,计算速度和可用的系统和程序空间.

## 线程创建方式
* NSThread
* POSIX(有跨平台优势)
* NSObject生成一个线程:￼￼[myObj performSelectorInBackground:@selector(doSomething) withObject:nil];
* GCD

## 线程中断
杀死一个线程阻止了线程本身的清理工作,线程分配的内存可能造成泄漏,并且其他线程当前使用的资源可能没有被正确清理干净,造成潜在的问题.应设计线程响应取消或退出的消息.
  


